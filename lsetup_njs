#!/bin/bash

MYDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
NJSMODE=$1
NJSVER=$2
ARCH=$3
PLAT=$4


echo "Downloading NJS $1 $2 $3 $4"

DLHOST="http://nodejs.org/dist"
if [ "$NJSMODE" == "iojs" ]; then
  DLHOST="http://iojs.org/dist"
fi

if [ "$PLAT" == "sunos" ]; then
  wget -nc "$DLHOST/v$NJSVER/node-v$NJSVER-sunos-$ARCH.tar.gz" -O src/node-$NJSVER-$ARCH.tar.gz
else
  wget -nc "$DLHOST/v$NJSVER/node-v$NJSVER-linux-$ARCH.tar.gz" -O src/node-$NJSVER-$ARCH.tar.gz
fi


echo "Installing NJS $1 $2 $3 $4"

if [ ! -e njs-files/$NJSVER-$ARCH ]; then
  tar -xzvf src/node-$NJSVER-$ARCH.tar.gz -C tmp
  mv tmp/node-$NJSVER-*-$ARCH njs-files/$NJSVER-$ARCH
fi

if [ ! -e lcb-files/src/$LCBVER-$ARCH ]; then
  tar -xzvf src/lcb-$LCBVER-src.tar.gz -C tmp
  mv tmp/libcouchbase-$LCBVER lcb-files/src/$LCBVER-$ARCH
fi
